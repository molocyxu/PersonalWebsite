---
import '../styles/global.css';
import PanoramaCarousel from '../components/PanoramaCarousel';
import PlanetNav from '../components/PlanetNav';

export interface Props {
  title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="alex zheng's personal website" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
    <link rel="dns-prefetch" href="https://fonts.gstatic.com" />
    <!-- Resource hints for faster navigation -->
    <link rel="prefetch" href="/gallery" />
    <link rel="prefetch" href="/timeline" />
    <link rel="prefetch" href="/contacts" />
    <!-- Performance optimization: defer non-critical scripts -->
    <title>{title} | alex zheng</title>
  </head>
  <body style="overflow-x: hidden; position: relative;">
    <div id="panorama-bg" aria-hidden="true"></div>
    <PlanetNav client:load />
    <PanoramaCarousel client:only="react" />
    <div id="page-slot" style="display:none;">
      <div id="page-content-root">
        <slot />
      </div>
    </div>
    <script is:inline>
      (function() {
        if (typeof document === 'undefined' || typeof window === 'undefined') return;

        var html = document.documentElement;
        var STAR_SEED = 101; // deterministic seed base
        var PAGES = [
          '/',
          '/gallery',
          '/timeline',
          '/projects',
          '/research',
          '/education',
          '/experience',
          '/saturn',
          '/honors',
          '/life',
          '/skills',
          '/contacts'
        ];
        var STAR_VARIANTS = {
          '/gallery': 0,
          '/timeline': 1,
          '/projects': 2,
          '/education': 0,
          '/research': 1,
          '/life': 2,
          '/honors': 0,
          '/contacts': 1,
          '/experience': 2,
          '/skills': 0,
          '/saturn': 1
        };

        function seededRandom(seed) {
          return function() {
            seed = (seed * 9301 + 49297) % 233280;
            return seed / 233280;
          };
        }

        function generateStarTile(seed) {
          var width = 1200;
          var height = 600;
          var canvas = document.createElement('canvas');
          canvas.width = width;
          canvas.height = height;
          var ctx = canvas.getContext('2d');
          if (!ctx) return '';

          var rand = seededRandom(seed || 999);
          ctx.fillStyle = '#000000';
          ctx.fillRect(0, 0, width, height);

          var starCount = 220;
          for (var i = 0; i < starCount; i++) {
            var x = rand() * width;
            var y = rand() * height;
            var radius = rand() * 0.9 + 0.3;
            var opacity = rand() * 0.35 + 0.2;
            ctx.fillStyle = 'rgba(255, 255, 255, ' + opacity + ')';
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fill();
          }

          return 'url(' + canvas.toDataURL('image/png') + ')';
        }

        var STAR_VARIANT_CACHE = {};

        window.__getStarVariant = function(variant) {
          var key = String(variant || 0);
          if (STAR_VARIANT_CACHE[key]) return STAR_VARIANT_CACHE[key];
          var seed = STAR_SEED + (variant || 0) * 1000;
          var tile = generateStarTile(seed);
          STAR_VARIANT_CACHE[key] = tile;
          return tile;
        };

        window.__getStarBg = function() {
          return window.__getStarVariant(0);
        };

        document.body.classList.add('page-loaded');
        document.documentElement.classList.add('page-loaded');
        html.dataset.slide = 'center';
        html.dataset.slidePhase = 'centered';

        // Set deterministic panorama background before rendering
        var path = window.location.pathname || '/';
        var starBg = window.__getStarBg();
        document.documentElement.style.setProperty('--panorama-bg', starBg);
        sessionStorage.setItem('star-bg:' + path, starBg);
      })();
      
      // Link clicks use normal navigation (no sliding)
    </script>
  </body>
</html>

---
import Layout from '../layouts/Layout.astro';
import MagicalText from '../components/MagicalText';

const planetColor = '#7AA6D6'; // Kuiper belt
const planetColorRgb = '122, 166, 214';

const languages = [
  { label: 'java (oracle certified)', size: 'large' },
  { label: 'python', size: 'large' },
  { label: 'c', size: 'large' },
  { label: 'c++', size: 'large' },
  { label: 'sml', size: 'medium' },
  { label: 'typescript', size: 'medium' },
  { label: 'javascript', size: 'medium' },
  { label: 'sql', size: 'medium' },
  { label: 'html', size: 'medium' },
  { label: 'css', size: 'medium' },
  { label: 'solidity', size: 'small' },
];

const aiMl = [
  { label: 'pytorch', size: 'large' },
  { label: 'tensorflow', size: 'large' },
  { label: 'scikit-learn', size: 'large' },
  { label: 'hugging face', size: 'medium' },
  { label: 'gradio', size: 'small' },
  { label: 'apache spark', size: 'medium' },
  { label: 'wandb', size: 'medium' },
  { label: 'opencv', size: 'large' },
  { label: 'google colab', size: 'medium' },
  { label: 'jupyter notebook', size: 'medium' },
  { label: 'whisper', size: 'small' },
  { label: 'word2vec', size: 'small' },
  { label: 'claude api', size: 'medium' },
];

const web = [
  { label: 'react', size: 'large' },
  { label: 'angular.js', size: 'small' },
  { label: 'astro', size: 'small' },
  { label: 'node.js', size: 'large' },
  { label: 'flask', size: 'large' },
  { label: 'django', size: 'medium' },
  { label: 'mongodb', size: 'medium' },
  { label: 'postgresql', size: 'large' },
  { label: 'railway', size: 'medium' },
  { label: 'heroku', size: 'small' },
  { label: 'vercel', size: 'large' },
  { label: 'stripe', size: 'medium' },
  { label: 'github pages', size: 'medium' },
  { label: 'rest api', size: 'medium' },
  { label: 'indexeddb', size: 'small' },
];

const miscellaneous = [
  { label: 'aws', size: 'large' },
  { label: 'google cloud', size: 'medium' },
  { label: 'docker', size: 'large' },
  { label: 'kubernetes', size: 'large' },
  { label: 'redis', size: 'medium' },
  { label: 'git', size: 'large' },
  { label: 'github', size: 'large' },
  { label: 'linux', size: 'medium' },
  { label: 'unix', size: 'small' },
  { label: 'android studio', size: 'medium' },
  { label: 'figma', size: 'small' },
  { label: 'latex', size: 'small' },
  { label: 'cursor', size: 'medium' },
];

const clamp = (value: number, min: number, max: number) => Math.min(max, Math.max(min, value));

const seededRandom = (seed: number) => () => {
  seed = (seed * 9301 + 49297) % 233280;
  return seed / 233280;
};

const FIELD_WIDTH = 1500;
const FIELD_HEIGHT = 720;

const buildCluster = (
  items: Array<string | { label: string; size?: 'small' | 'medium' | 'large' | 'xl' }>,
  centerX: number,
  centerY: number,
  spreadX: number,
  spreadY: number,
  seedOffset: number,
) => {
  const rand = seededRandom(401 + seedOffset);
  const placed: Array<{ x: number; y: number; size: number }> = [];
  const paddingPx = 6;

  return items.map((item, index) => {
    const label = typeof item === 'string' ? item : item.label;
    const sizeHint = typeof item === 'string' ? undefined : item.size;
    const size =
      sizeHint === 'small'
        ? Math.round(12 + rand() * 8)
        : sizeHint === 'medium'
          ? Math.round(20 + rand() * 8)
          : sizeHint === 'large'
            ? Math.round(28 + rand() * 12)
            : sizeHint === 'xl'
              ? Math.round(40 + rand() * 10)
              : Math.round(14 + rand() * 26);
    let x = centerX;
    let y = centerY;

    for (let attempt = 0; attempt < 80; attempt += 1) {
      const angle = rand() * Math.PI * 2;
      const radiusX = (rand() ** 0.6) * spreadX;
      const radiusY = (rand() ** 0.6) * spreadY;
      const nextX = clamp(centerX + Math.cos(angle) * radiusX, 4, 96);
      const nextY = clamp(centerY + Math.sin(angle) * radiusY, 16, 92);

      const hasOverlap = placed.some(({ x: otherX, y: otherY, size: otherSize }) => {
        const dxPx = ((nextX - otherX) / 100) * FIELD_WIDTH;
        const dyPx = ((nextY - otherY) / 100) * FIELD_HEIGHT;
        const minDistance = (size + otherSize) * 0.5 + paddingPx;
        return Math.hypot(dxPx, dyPx) < minDistance;
      });

      if (!hasOverlap) {
        x = nextX;
        y = nextY;
        break;
      }
    }

    placed.push({ x, y, size });

    const rotation = Math.round(rand() * 360);
    const spin = (12 + rand() * 18).toFixed(2);
    const drift = (rand() * 4 - 2).toFixed(2);
    const ellipseX = Math.round(6 + rand() * 12);
    const ellipseY = Math.round(16 + rand() * 18);
    const ellipseTilt = Math.round(rand() * 20 - 10);
    const ellipseDuration = (16 + rand() * 18).toFixed(2);
    const ellipsePhase = `-${Math.round(rand() * 80)}s`;

    return {
      id: `${label}-${index}`,
      label,
      x,
      y,
      size,
      rotation,
      spin,
      drift,
      ellipseX,
      ellipseY,
      ellipseTilt,
      ellipseDuration,
      ellipsePhase,
    };
  });
};

const languageComets = buildCluster(languages, 14, 46, 9, 16, 1);
const aiMlComets = buildCluster(aiMl, 40, 34, 10, 16, 2);
const webComets = buildCluster(web, 68, 54, 11, 18, 3);
const miscComets = buildCluster(miscellaneous, 90, 66, 8, 14, 4);
---

<Layout title="skills">
  <div class="min-h-screen relative overflow-hidden" style="background: transparent;">
    <!-- Star background -->
    <div class="absolute inset-0 page-starfield"></div>
    <div class="max-w-7xl mx-auto px-10 py-24 relative z-10">
      <div class="max-w-6xl animate-fade-in">
        <div class="inline-block border-l-4 pl-6 mb-8" style={`border-color: rgba(${planetColorRgb}, 0.4);`}>
          <h1 class="text-3xl font-medium mb-4 lowercase tracking-tight">
            <MagicalText text="skills" color={planetColor} colorRgb={planetColorRgb} client:load />
          </h1>
          <div class="h-px w-24 mb-6" style={`background: linear-gradient(to right, rgba(${planetColorRgb}, 0.6), transparent);`}></div>
        </div>
        <div class="belt-field-wrap belt-comet-wrap belt-field-shift">
          <div class="comet-field">
          <div class="comet-title comet-languages">languages</div>
          <div class="comet-title comet-aiml">ai / ml</div>
          <div class="comet-title comet-web">web dev</div>
          <div class="comet-title comet-misc">misc.</div>

          {languageComets.map((comet, index) => (
            <div
              key={comet.id}
              class="comet-wrapper"
              style={`left:${comet.x}%; top:${comet.y}%; --size:${comet.size}px; --rot:${comet.rotation}deg; --spin:${comet.spin}s; --drift:${comet.drift}px; transform: translate(-50%, -50%);`}
              tabindex="0"
              aria-label={comet.label}
            >
              <div class="comet-ellipse-tilt" style={`--ellipse-tilt:${comet.ellipseTilt}deg;`}>
                <div
                  class="comet-ellipse"
                  style={`--ellipse-x:${comet.ellipseX}px; --ellipse-y:${comet.ellipseY}px; --ellipse-duration:${comet.ellipseDuration}s; --ellipse-phase:${comet.ellipsePhase};`}
                >
                  <div class="comet-rotator">
                    <div
                      class={`comet comet-shape-${(index % 4) + 1}`}
                      style={`width:${comet.size}px; height:${comet.size}px;`}
                    ></div>
                    <span class="comet-label">{comet.label}</span>
                  </div>
                </div>
              </div>
            </div>
          ))}

          {aiMlComets.map((comet, index) => (
            <div
              key={comet.id}
              class="comet-wrapper"
              style={`left:${comet.x}%; top:${comet.y}%; --size:${comet.size}px; --rot:${comet.rotation}deg; --spin:${comet.spin}s; --drift:${comet.drift}px; transform: translate(-50%, -50%);`}
              tabindex="0"
              aria-label={comet.label}
            >
              <div class="comet-ellipse-tilt" style={`--ellipse-tilt:${comet.ellipseTilt}deg;`}>
                <div
                  class="comet-ellipse"
                  style={`--ellipse-x:${comet.ellipseX}px; --ellipse-y:${comet.ellipseY}px; --ellipse-duration:${comet.ellipseDuration}s; --ellipse-phase:${comet.ellipsePhase};`}
                >
                  <div class="comet-rotator">
                    <div
                      class={`comet comet-shape-${(index % 4) + 1}`}
                      style={`width:${comet.size}px; height:${comet.size}px;`}
                    ></div>
                    <span class="comet-label">{comet.label}</span>
                  </div>
                </div>
              </div>
            </div>
          ))}

          {webComets.map((comet, index) => (
            <div
              key={comet.id}
              class="comet-wrapper"
              style={`left:${comet.x}%; top:${comet.y}%; --size:${comet.size}px; --rot:${comet.rotation}deg; --spin:${comet.spin}s; --drift:${comet.drift}px; transform: translate(-50%, -50%);`}
              tabindex="0"
              aria-label={comet.label}
            >
              <div class="comet-ellipse-tilt" style={`--ellipse-tilt:${comet.ellipseTilt}deg;`}>
                <div
                  class="comet-ellipse"
                  style={`--ellipse-x:${comet.ellipseX}px; --ellipse-y:${comet.ellipseY}px; --ellipse-duration:${comet.ellipseDuration}s; --ellipse-phase:${comet.ellipsePhase};`}
                >
                  <div class="comet-rotator">
                    <div
                      class={`comet comet-shape-${(index % 4) + 1}`}
                      style={`width:${comet.size}px; height:${comet.size}px;`}
                    ></div>
                    <span class="comet-label">{comet.label}</span>
                  </div>
                </div>
              </div>
            </div>
          ))}

          {miscComets.map((comet, index) => (
            <div
              key={comet.id}
              class="comet-wrapper"
              style={`left:${comet.x}%; top:${comet.y}%; --size:${comet.size}px; --rot:${comet.rotation}deg; --spin:${comet.spin}s; --drift:${comet.drift}px; transform: translate(-50%, -50%);`}
              tabindex="0"
              aria-label={comet.label}
            >
              <div class="comet-ellipse-tilt" style={`--ellipse-tilt:${comet.ellipseTilt}deg;`}>
                <div
                  class="comet-ellipse"
                  style={`--ellipse-x:${comet.ellipseX}px; --ellipse-y:${comet.ellipseY}px; --ellipse-duration:${comet.ellipseDuration}s; --ellipse-phase:${comet.ellipsePhase};`}
                >
                  <div class="comet-rotator">
                    <div
                      class={`comet comet-shape-${(index % 4) + 1}`}
                      style={`width:${comet.size}px; height:${comet.size}px;`}
                    ></div>
                    <span class="comet-label">{comet.label}</span>
                  </div>
                </div>
              </div>
            </div>
          ))}
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>

<style>
  @keyframes fade-in {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .animate-fade-in {
    animation: fade-in 0.8s ease-out;
  }
</style>

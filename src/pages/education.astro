---
import Layout from '../layouts/Layout.astro';
import MagicalText from '../components/MagicalText';

const planetColor = '#A0988A'; // Asteroid belt
const planetColorRgb = '160, 152, 138';

const planoWestCourses = [
  { label: 'AP Music Theory', size: 'small' },
  { label: 'AP English Language and Composition', size: 'small' },
  { label: 'AP English Literature and Composition', size: 'small' },
  { label: 'AP European History', size: 'small' },
  { label: 'AP Human Geography', size: 'small' },
  { label: 'AP Microeconomics', size: 'medium' },
  { label: 'AP Macroeconomics', size: 'medium' },
  { label: 'AP United States History', size: 'small' },
  { label: 'AP World History: modern', size: 'small' },
  { label: 'AP Statistics', size: 'large' },
  { label: 'AP Computer Science A', size: 'large' },
  { label: 'AP Calculus BC', size: 'large' },
  { label: 'AP Chemistry', size: 'medium' },
  { label: 'AP Environmental Science', size: 'medium' },
  { label: 'AP Physics C: Electricity and Magnetism', size: 'medium' },
  { label: 'AP Physics C: Mechanics', size: 'medium' },
  { label: 'AP Chinese Language and Culture', size: 'medium' },
  { label: 'multivariable calculus', size: 'large' },
  { label: 'differential equations', size: 'large' },
  { label: 'digital electronics', size: 'medium' },
];

const cmuCourses = [
  { label: '15122 principles of imperative computation', size: 'large' },
  { label: '15151 mathematical foundations for computer science', size: 'large' },
  { label: '21242 matrix theory', size: 'medium' },
  { label: '21295 putnam seminar', size: 'medium' },
  { label: '15150 principles of functional programming', size: 'medium' },
  { label: '15251 great ideas in theoretical cs', size: 'large' },
  { label: '15259 probability & computing', size: 'large' },
  { label: '21269 vector analysis', size: 'medium' },
  { label: '18213 computer systems', size: 'medium' },
  { label: '10701 machine learning', size: 'large' },
  { label: '11485 introduction to deep learning', size: 'large' },
  { label: '15210 parallel and sequential data structures and algorithms', size: 'large' },
  { label: '21301 combinatorics', size: 'medium' },
  { label: '10403 deep reinforcement learning and control', size: 'large' },
  { label: '10422 foundations of learning, game theory, and their connections', size: 'large' },
  { label: '15195 competitive programming i', size: 'large' },
  { label: '15445 database systems', size: 'medium' },
  { label: '15451 algorithm design & analysis', size: 'large' },
  { label: '15455 undergraduate complexity theory', size: 'medium' },
  { label: '79189 history of democracy: thinking beyond the self', size: 'small' },
  { label: '76107 writing about data', size: 'small' },
  { label: '33104 experimental physics', size: 'small' },
  { label: '76108 writing about public problems', size: 'small' },
  { label: '82279 anime - visual interplay between japan and the world', size: 'small' },
  { label: '88230 human intelligence and human stupidity', size: 'small' },
];

const cmuActivities = [
  { label: 'poker club', size: 'medium' },
  { label: 'math club', size: 'large' },
  { label: 'rec badminton club', size: 'small' },
  { label: 'acm@cmu', size: 'large' },
  { label: 'scottylabs', size: 'large' },
  { label: 'data science club', size: 'large' },
  { label: 'cubing club', size: 'medium' },
  { label: 'quant club vice president', size: 'xl' },
  { label: 'carnegie ai safety initiative', size: 'medium' },
  { label: 'chess club', size: 'medium' },
];

const clamp = (value: number, min: number, max: number) => Math.min(max, Math.max(min, value));

const seededRandom = (seed: number) => () => {
  seed = (seed * 9301 + 49297) % 233280;
  return seed / 233280;
};

const FIELD_WIDTH = 1500;
const FIELD_HEIGHT = 720;

const buildCluster = (
  items: Array<string | { label: string; size?: 'small' | 'medium' | 'large' | 'xl' }>,
  centerX: number,
  centerY: number,
  spreadX: number,
  spreadY: number,
  seedOffset: number,
) => {
  const rand = seededRandom(101 + seedOffset);
  const placed: Array<{ x: number; y: number; size: number }> = [];
  const paddingPx = 6;

  return items.map((item, index) => {
    const label = typeof item === 'string' ? item : item.label;
    const sizeHint = typeof item === 'string' ? undefined : item.size;
    const size =
      sizeHint === 'small'
        ? Math.round(12 + rand() * 8)
        : sizeHint === 'medium'
          ? Math.round(20 + rand() * 8)
          : sizeHint === 'large'
            ? Math.round(30 + rand() * 10)
            : sizeHint === 'xl'
              ? Math.round(44 + rand() * 10)
            : Math.round(12 + rand() * 28);
    let x = centerX;
    let y = centerY;

    for (let attempt = 0; attempt < 80; attempt += 1) {
      const angle = rand() * Math.PI * 2;
      const radiusX = (rand() ** 0.6) * spreadX;
      const radiusY = (rand() ** 0.6) * spreadY;
      const nextX = clamp(centerX + Math.cos(angle) * radiusX, 4, 96);
      const nextY = clamp(centerY + Math.sin(angle) * radiusY, 16, 92);

      const hasOverlap = placed.some(({ x: otherX, y: otherY, size: otherSize }) => {
        const dxPx = ((nextX - otherX) / 100) * FIELD_WIDTH;
        const dyPx = ((nextY - otherY) / 100) * FIELD_HEIGHT;
        const minDistance = (size + otherSize) * 0.5 + paddingPx;
        return Math.hypot(dxPx, dyPx) < minDistance;
      });

      if (!hasOverlap) {
        x = nextX;
        y = nextY;
        break;
      }
    }

    placed.push({ x, y, size });

    const rotation = Math.round(rand() * 360);
    const spin = (10 + rand() * 18).toFixed(2);
    const drift = (rand() * 4 - 2).toFixed(2);

    return {
      id: `${label}-${index}`,
      label,
      x,
      y,
      size,
      rotation,
      spin,
      drift,
    };
  });
};

const planoWestAsteroids = buildCluster(planoWestCourses, 10, 56, 13, 18, 1);
const cmuCourseAsteroids = buildCluster(cmuCourses, 52, 50, 16, 20, 2);
const cmuActivityAsteroids = buildCluster(cmuActivities, 90, 66, 11, 16, 3);
---

<Layout title="education">
  <div class="min-h-screen relative overflow-hidden" style="background: transparent;">
    <!-- Star background -->
    <div class="absolute inset-0 page-starfield"></div>
    <!-- Asteroid belt color tint -->
    <div class="absolute inset-0 opacity-15" style={`background: radial-gradient(ellipse at center, rgba(${planetColorRgb}, 0.2), rgba(${planetColorRgb}, 0.05) 50%, transparent 80%);`}></div>
    <div class="max-w-7xl mx-auto px-10 py-24 relative z-10">
      <div class="max-w-6xl animate-fade-in">
        <div class="inline-block border-l-4 pl-6 mb-8" style="border-color: rgba(160, 152, 138, 0.4);">
          <h1 class="text-3xl font-medium mb-4 lowercase tracking-tight">
            <MagicalText text="education" color={planetColor} colorRgb={planetColorRgb} client:load />
          </h1>
          <div class="h-px w-24 mb-6" style="background: linear-gradient(to right, rgba(160, 152, 138, 0.6), transparent);"></div>
        </div>
        <div class="belt-field-wrap belt-asteroid-wrap belt-field-shift">
          <div class="asteroid-field">
          <div class="cluster-title left-title">plano west</div>
          <div class="cluster-subtitle left-subtitle">courses</div>

          <div class="cluster-title mid-title">carnegie mellon</div>
          <div class="cluster-subtitle mid-degree">
            b.s. in c.s.<br />ml concentration<br />math minor
          </div>
          <div class="cluster-subtitle mid-subtitle">courses</div>

          <div class="cluster-subtitle right-subtitle">activities</div>

          {planoWestAsteroids.map((asteroid, index) => (
            <div
              key={asteroid.id}
              class="asteroid-wrapper"
              style={`left:${asteroid.x}%; top:${asteroid.y}%; --size:${asteroid.size}px; --rot:${asteroid.rotation}deg; --spin:${asteroid.spin}s; --drift:${asteroid.drift}px; transform: translate(-50%, -50%);`}
              tabindex="0"
              aria-label={asteroid.label}
            >
              <div class="asteroid-rotator">
                <div
                  class={`asteroid asteroid-shape-${(index % 4) + 1}`}
                  style={`width:${asteroid.size}px; height:${asteroid.size}px;`}
                ></div>
                <span class="asteroid-label">{asteroid.label}</span>
              </div>
            </div>
          ))}

          {cmuCourseAsteroids.map((asteroid, index) => (
            <div
              key={asteroid.id}
              class="asteroid-wrapper"
              style={`left:${asteroid.x}%; top:${asteroid.y}%; --size:${asteroid.size}px; --rot:${asteroid.rotation}deg; --spin:${asteroid.spin}s; --drift:${asteroid.drift}px; transform: translate(-50%, -50%);`}
              tabindex="0"
              aria-label={asteroid.label}
            >
              <div class="asteroid-rotator">
                <div
                  class={`asteroid asteroid-shape-${(index % 4) + 1}`}
                  style={`width:${asteroid.size}px; height:${asteroid.size}px;`}
                ></div>
                <span class="asteroid-label">{asteroid.label}</span>
              </div>
            </div>
          ))}

          {cmuActivityAsteroids.map((asteroid, index) => (
            <div
              key={asteroid.id}
              class="asteroid-wrapper"
              style={`left:${asteroid.x}%; top:${asteroid.y}%; --size:${asteroid.size}px; --rot:${asteroid.rotation}deg; --spin:${asteroid.spin}s; --drift:${asteroid.drift}px; transform: translate(-50%, -50%);`}
              tabindex="0"
              aria-label={asteroid.label}
            >
              <div class="asteroid-rotator">
                <div
                  class={`asteroid asteroid-shape-${(index % 4) + 1}`}
                  style={`width:${asteroid.size}px; height:${asteroid.size}px;`}
                ></div>
                <span class="asteroid-label">{asteroid.label}</span>
              </div>
            </div>
          ))}
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>

